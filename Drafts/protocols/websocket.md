# 1. 历史演进概览
什么是 WebSocket？它是定义客户端和服务端如何通过 Web 进行通信的一种网络协议，该通信协议于2011年被IETF（互联网工程任务组）定为标准RFC 6455，并由RFC7936补充规范。

在 WebSocket 协议之前，还有几种方案可用于实现即时通信。下面将依次介绍。

![](https://tva1.sinaimg.cn/large/008eGmZEgy1goiacxvxoij316008ut9j.jpg)

## 1.1 HTTP1.0/1.1

在HTTP 1.0/1.1 中，客户端和服务端建立通信，需要通过发送请求与等待响应。由于 HTTP 是无状态的的，每一次请求和响应都需要在 header 中携带大量信息，并且由于其半双工特性，同一时间流量只能单向流动，即请求发送出去，需要一直等待响应的到来，才能做下一步的操作，一定程度上造成了通信低效。

![](https://tva1.sinaimg.cn/large/008eGmZEgy1goig7kifiaj30ia0memy3.jpg)


## 1.2 轮询
在需要显示股票价格走势等这一类对信息实时性要求较高的场景，如果每次都由用户手动去刷新浏览器获取最新信息，会存在明显滞后性。因此可以设定一个定时器，每个一段时间，就像服务端发送请求获取最新结果，这种方法被称为”轮询“（polling）。

![](https://tva1.sinaimg.cn/large/008eGmZEgy1goig5rizq1j30j60lkabt.jpg)

如果能明确知道服务端数据更新的间隔，那么轮询是一个不错的方案。然而大部分时候，是无法预测数据什么时候更新的，每个固定周期都发送请求查询，会产生很多不必要的请求，造成浪费。

## 1.3 长轮询
长轮询（long polling）则是基于轮询的另一种方案，它也被称为 Comet 或者反向 AJAX。服务端收到客户端请求后，会保持请求打开，直到有客户端可用的信息或者超时了，才返回可给客户端。这么处理相对于普通的轮询，**优点**是可以减少不必要的请求。但是当信息更新很频繁时，长轮询相对于普通轮询的优势就不再明显。

![](https://tva1.sinaimg.cn/large/008eGmZEgy1goig5r42y2j30nu0liabi.jpg)

## 1.4 HTTP Streaming
前面设计的轮询，每一次请求响应结束后，都会关闭连接。下一次请求，客户端依然需要在请求头中携带大量信息。而 HTTP Streaming 流化技术的实现机制是客户端发送一个请求，服务端发送一个持续更新和保持打开的开放响应。每当服务端有客户端可用信息时，就更新响应，但是连接始终保持打开。通过这种方式来规避频繁请求带来的不必要开销。

![](https://tva1.sinaimg.cn/large/008eGmZEgy1goig5qmrt9j30hq0m8jsc.jpg)

HTTP Stream 存在的缺点是和灵活的全双工通信还存在着距离，还是以单向通信为主，服务端可以自由地发数据给客户端，但客户端缺没办法。

## 1.5 Websocket



# 2. 优缺点
优点：


# 3. 连接管理
## 3.1 握手建立
### 3.1.1 HTTP 请求升级
### 3.1.2 Server response

### 3.1.3 连接成功

## 3.2 连接关闭流程

### 3.2.1 收到关闭帧，进入closing状态
此时可以接受数据，但是无法发送


# 4. 会话管理


# 5. 数据格式




# 参考资料
https://tools.ietf.org/html/rfc6455
HTML5 WebSocket权威指南
极客时间 抓包。。

https://en.wikipedia.org/wiki/WebSocket#References

